# Copyright 2021 IBM Corporation
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
name: Input Postgresql
description: This notebook pulls data from a postgresql database as CSV on a given SQL statement

inputs:
- {name: host, type: String, description: 'hostname of database server'}
- {name: database, type: String, description: 'database name'}
- {name: user, type: String, description: 'db user'}
- {name: password, type: String, description: 'db password'}
- {name: port, type: Integer, description: 'db port'}
- {name: sql, type: String, description: 'sql query statement to be executed'}
- {name: data_dir, type: String, description: 'temporal data storage for local execution'}


outputs:
- {name: output_data_csv, type: String, description: 'path and file name for output'}


implementation:
    container:
        image: continuumio/anaconda3:2020.07
        command:
        - sh
        - -ec
        - |
          mkdir -p `echo $0 |sed -e 's/\/[a-zA-Z0-9]*$//'`
          wget https://raw.githubusercontent.com/IBM/claimed/master/component-library/input/input-postgresql.ipynb
          ipython ./input-postgresql.ipynb output_data_csv="$0" host="$1" database="$2" user="$3" password="$4" port="$5" sql="$6" data_dir="$7"
        - {outputPath: output_data_csv}
        - {inputValue: host}
        - {inputValue: database}
        - {inputValue: user}
        - {inputValue: password}
        - {inputValue: port}
        - {inputValue: sql}
        - {inputValue: data_dir}
